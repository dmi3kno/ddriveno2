{
  "hash": "7f9c4bf5f9897e607baa826d298f4a39",
  "result": {
    "markdown": "---\ntitle: \"Bivariate quantiles\"\nauthor: \"Deemah\"\ndate: \"2023-02-28\"\ncategories: [paper review, quantiles]\nimage: \"fig-bvn-pdf-1.png\"\nimage-width: 200px\nbibliography: references.bib\ncitation:\n  type: \"webpage\"\n  container-title: \"$d /drive blog\"\n  author: \"Dmytro Perepolkin\"\n  url: \"https://www.ddrive.no/posts/2023-02-28-bivariate-quantiles/\"\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(qpd)\nlibrary(hrbrthemes)\n```\n:::\n\n\n\n## Introduction\n\nOne of the recent papers I included in [Quantile Statistics Overlay](https://peeriodicals.com/peeriodicals/quantile-statistics-overlay) is @nair2023PropertiesBivariateDistributions. Prof. N. Unnikrishnan Nair is the [former head of Statistics Department](https://stats.cusat.ac.in/index.php/Faculty) at the Cochin University of Science and Technology (Kerala, India). His co-author here is Dr B. Vineshkumar, the [Assistant Professor of Statistics](http://gactvm.ac.in/?page_id=305) at the Government Arts College, Thiruvananthapuram (also in Kerala). Prof. N.U. Nair and Dr. Vineshkumar have been prolific contributors to the field of quantile statistics and I will be including more of their work into our overlay publication.\n\n## Bivariate Quantiles\n\nThe earlier paper @vineshkumar2019BivariateQuantileFunctions provided the helpful definition of bivariate quantiles, which extends the univariate case for quantile function of $X$\n\n\n$$\n\\begin{gathered}\nQ_i(u_i)=\\inf\\{x_i\\vert F_i(x_i)\\geq u_i\\}, \\; u_i\\in I=[0,1]\n\\end{gathered}\n$$\n\n\nThe bivariate quantile function of $(X_1,X_2)$ is then given by\n\n\n$$\nQ(u_1, u_2)=(Q_1(u_1),Q_{21}(u_2\\vert u_1))\\\\\n$$\n\n\nwhere\n\n\n$$\n\\begin{gathered}\nQ_1(u_1)=\\inf\\{x_1\\vert F_1(x_1)\\geq u_1\\}\\\\\nQ_{21}(u_2\\vert u_1)=\\inf\\{x_2\\vert P(X_2\\leq x_2 \\vert X_1>Q_1(u_1))\\geq u_2\\}\n\\end{gathered}\n$$\n\nRecall, that the the joint survival function is $\\bar{F}(x_1,x_2)=1-F_1(x_1)-F_2(x_2)+F(x_1,x_2)$ [@kundu2009BivariateGeneralizedExponential], which is a multivariate extension of the univariate survival function $\\bar{F}(x)=1-F(x)$. The authors factorize the joint survival function $\\bar{F}(x_1,x_2)$ as follows:\n\n\n$$\n\\bar{F}(x_1, x_2)=P(X_1> x_1)P(X_2> x_2 \\vert X_1 > x_1)= \\bar{F}(x_1)\\bar{F}_{21}(x_1,x_2)\n$$\n\n\nThe conditional distribution function $F_{21}(x_1,x_2)$ should not be confused with the marginal distribution function $F_2(x_2)$. The conditional distribution function can be computed from the joint distribution function using the formulae above (with the help of the marginal).\n\nThe conditional survival function $\\bar{F}_{21}(x_1,x_2)$ and the corresponding conditional quantile function $Q_{21}(u_2\\vert u_1)$ constitute the main element in the definition of bivariate quantiles.\n\n\n$$\nQ_{21}(u_2\\vert u_1)=\\inf\\{x_2\\vert F_{21}(Q_1,x_2)\\geq u_2\\}\n$$\n\n\nWe can find the conditional quantile function $Q_{21}$ by inverting the conditional distribution function $F_{21}$ for $x_2$, and substituting the marginal $Q_1(u_1)$ instead of $x_1$. \n\n## Examples\n\n@nair2023PropertiesBivariateDistributions provide several examples which might be illuminating to have a closer look at.\n\n### Mardia's bivariate Pareto distribution\n\nThe authors provide a survival function for the Mardia's bivariate Pareto distribution^[There seems to be a typo in the paper. It says -1 instead of +1 in the survival function]\n\n\n$$\n\\bar{F}(x_1, x_2)=(x_1+x_2+1)^{-c}, \\; x_1, x_2>1, c>0\n$$\n\n\nThe marginal quantile functions $Q_i(u_i)=(1-u_i)^{-1/c}-1$, therefore the marginal distribution functions are $F_i(x_i)=-\\left(x_i+1\\right)^{-c}+1$ for $i=1,2$. We can find the conditional survival function $\\bar{F}_{21}(x_1,x_2)=P(X_2>x_2\\vert X_1>x_1)$, and corresponding conditional distribution function $F_{21}(x_1,x_2)$ as\n\n\n$$\n\\begin{gathered}\n\\bar{F}_{21}(x_1,x_2)=\\frac{\\bar{F}(x_1, x_2)}{\\bar{F}_1(x_1)}=\\frac{(x_1+x_2+1)^{-c}}{(x_1+1)^{-c}}\\\\\nF_{21}(x_1,x_2)=1-\\left(\\frac{x_1+x_2+1}{x_1+1}\\right)^{-c}\n\\end{gathered}\n$$\n\n\nNow, we need to invert this, i.e. solve it for $x_2$, because we are interested in conditional quantile function $Q_{21}(u2\\vert u1)$.\n\n\n$$\n\\begin{gathered}\nu_2=1-\\left(\\frac{x_1+x_2+1}{x_1+1}\\right)^{-c}\\\\\n(1-u_2)^{-1/c}=\\frac{x_1+x_2+1}{x_1+1}\\\\\n(1-u_2)^{-1/c}(x_1+1)=x_1+x_2+1\\\\\n(1-u_2)^{-1/c}(x_1+1)-x_1-1=x_2\n\\end{gathered}\n$$\n\n\nWe are almost there. Now we drop in marginal $Q_1(u_1)=(1-u_1)^{-1/c}-1$ instead of $x_1$.\n\n\n$$\n\\begin{gathered}\n(1-u_2)^{-1/c}([(1-u_1)^{-1/c}-1]+1)-[(1-u_1)^{-1/c}-1]-1=x_2\\\\\n(1-u_2)^{-1/c}(1-u_1)^{-1/c}-(1-u_1)^{-1/c}=x_2\\\\\nQ_{21}(u_1, u_2)=(1-u_1)^{-1/c}[(1-u_2)^{-1/c}-1]\n\\end{gathered}\n$$\n\n\nWhich is exactly the solution provided in the paper. Now we can proceed to sampling from our brand new bivariate quantile function.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nqmardiapareto1 <- function(u, cc){\n  mic <- (-1/cc) #minus inverse c\n  (1-u)^mic-1\n}\n\nqmardiapareto21 <- function(u2, u1, cc){\n  mic <- (-1/cc)\n  (1-u1)^mic*((1-u2)^mic-1)\n}\n\nset.seed(1)\nn <- 1e3\ncc <- 10\ntibble::tibble(u1=runif(n),\n               u2=runif(n),\n               x1=qmardiapareto1(u1,cc),\n               x2=qmardiapareto21(u2, u1, cc)) %>%  \n  ggplot()+\n  geom_point(aes(x1, x2))+\n  theme_ipsum_rc(grid_col=\"grey95\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\n### Bivariate Pareto distribution\n\nAnother variant of bivariate Pareto distribution is provided in @vineshkumar2019BivariateQuantileFunctions. Here, the joint survival function is given by\n\n\n$$\n\\bar{F}(x_1, x_2)=(1+a_1x_1+a_2x_2+bx_1x_2)^{-p}\n$$\n\n\nwhere $x_1,x_2>0, \\;a_1,a_2>0, \\; 0\\leq b \\leq (p-1)a_1a_2$. The marginal distribution is given by $F_i(x_i)=1-(1+a_ix_i)^{-p}$ and the inverse is $Q_i(u_i)=\\frac{1}{a_i}[(1-u_i)^{-1/p}-1]$^[Note that the paper missed the square brackets around the basic quantile function].\n\nWe find the conditional survival and distribution functions as\n\n\n$$\n\\begin{gathered}\n\\bar{F}_{21}(x_1,x_2)=\\frac{\\bar{F}(x_1, x_2)}{\\bar{F}_1(x_1)}=\\frac{(1+a_1x_1+a_2x_2+bx_1x_2)^{-p}}{(1+a_1x_1)^{-p}}\\\\\nF_{21}(x_1,x_2)=1-\\left(\\frac{1+a_1x_1+a_2x_2+bx_1x_2}{1+a_1x_1}\\right)^{-p}\n\\end{gathered}\n$$\n\n\nNow we invert $F_{21}$ for $x_2$. \n\n\n$$\n\\begin{gathered}\nu_2=1-\\left(\\frac{1+a_1x_1+a_2x_2+bx_1x_2}{1+a_1x_1}\\right)^{-p}\\\\\n(1-u_2)^{-1/p}=\\frac{1+a_1x_1+a_2x_2+bx_1x_2}{1+a_1x_1}\\\\\n(1-u_2)^{-1/p}({1+a_1x_1})-1-a_1x_1=a_2x_2+bx_1x_2\\\\\n(1-u_2)^{-1/p}({1+a_1x_1})-1-a_1x_1=x_2(a_2+bx_1)\\\\\nx_2=\\frac{\\left(1-u_2\\right)^{-\\frac{1}{p}}+a_1x_1\\left(1-u_2\\right)^{-\\frac{1}{p}}-a_1x_1-1}{a_2+bx_1}\n\\end{gathered}\n$$\n\n\nAnd drop in the marginal quantile function instead of $x_1$.\n\n\n$$\n\\begin{gathered}\nQ_{21}(u_2\\vert u_1)=\\frac{\\left(1-u_2\\right)^{-\\frac{1}{p}}+a_1x_1\\left(1-u_2\\right)^{-\\frac{1}{p}}-a_1x_1-1}{a_2+bx_1}\\\\\nQ_{21}(u_2\\vert u_1)=\\frac{\\left(1-u_2\\right)^{-\\frac{1}{p}}+a_1[\\frac{1}{a_1}[(1-u_1)^{-1/p}-1]]\\left(1-u_2\\right)^{-\\frac{1}{p}}-a_1[\\frac{1}{a_1}[(1-u_1)^{-1/p}-1]]-1}{a_2+b[\\frac{1}{a_1}[(1-u_1)^{-1/p}-1]]}\\\\\nQ_{21}(u_2\\vert u_1)=\\frac{\\left(1-u_2\\right)^{-\\frac{1}{p}}+[(1-u_1)^{-1/p}-1]\\left(1-u_2\\right)^{-\\frac{1}{p}}-[(1-u_1)^{-1/p}-1]-1}{a_2+\\frac{b}{a_1}[(1-u_1)^{-1/p}-1]}\\\\\nQ_{21}(u_2\\vert u_1)=\\frac{a_1[\\left(1-u_2\\right)^{-\\frac{1}{p}}(1-u_1)^{-1/p}-(1-u_1)^{-1/p}]}{a_1a_2+b[(1-u_1)^{-1/p}-1]}\\\\\nQ_{21}(u_2\\vert u_1)=\\frac{a_1(1-u_1)^{-1/p}[\\left(1-u_2\\right)^{-\\frac{1}{p}}-1]]}{a_1a_2+b[(1-u_1)^{-1/p}-1]}\n\\end{gathered}\n$$\n\n\nWhich is exactly the result in the paper.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nqotherpareto1 <- function(u, a, p){\n  mip <- (-1/p) #minus inverse p\n  1/a*(1-u)^mip-1\n}\n\nqotherpareto21 <- function(u2, u1, a2, a1, b, p){\n  mip <- (-1/p)\n  num <- a1*((1-u2)^mip-1)*((1-u1)^mip)\n  den <- a1*a2+b*((1-u1)^mip-1)\n  num/den\n}\n\nset.seed(1)\nn <- 1e3\np <- 10\na2 <- 0.2; a1 <- 0.4; b <- 0.1\ntibble::tibble(u1=runif(n),\n               u2=runif(n),\n               x1=qotherpareto1(u1, a1, p),\n               x2=qotherpareto21(u2, u1, a2, a1, b, p)) %>%  \n  ggplot()+\n  geom_point(aes(x1, x2))+\n  theme_ipsum_rc(grid_col=\"grey95\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n### Gumbel's bivariate exponential distribution\n\n@gumbel1960BivariateExponentialDistributions proposed two kinds of bivariate exponential distributions. The Type I distribution has the survival function\n\n\n$$\n\\bar{F}(x_1, x_2)=\\exp[-\\lambda_1x_1-\\lambda_2x_2-\\theta x_1x_2]\\\\\n$$\n\n\nThe marginal quantile function is, of course, $Q_i(u_i)=-\\ln(1-u_i)/\\lambda_i$ and the corresponding marginal distribution function is $F_i(x_i)=1-\\exp[-\\lambda_i x_i]$.\n\n@gumbel1960BivariateExponentialDistributions defined the distribution by the joint distribution function, which is slightly more verbose than the survival function. \n\n\n$$\n\\begin{gathered}\n\\bar{F}(x_1,x_2)=1-F_1(x_1)-F_2(x_2)+F(x_1,x_2)\\\\\nF(x_1, x_2)=\\exp[-\\lambda_1x_1-\\lambda_2x_2-\\theta x_1x_2]-1+1-\\exp[-\\lambda_1 x_1]+1-\\exp[-\\lambda_2 x_2]\\\\\nF(x_1, x_2)=1-\\exp[-\\lambda_1 x_1]-\\exp[-\\lambda_2 x_2]+\\exp[-\\lambda_1x_1-\\lambda_2x_2-\\theta x_1x_2]\n\\end{gathered}\n$$\n\n\nThe first step is to find the conditional survival and distribution functions.\n\n\n$$\n\\begin{gathered}\n\\bar{F}_{21}(x_1,x_2)=\\frac{\\bar{F}(x_1, x_2)}{\\bar{F}_1(x_1)}=\\frac{\\exp[-\\lambda_1x_1-\\lambda_2x_2-\\theta x_1x_2]}{\\exp[-\\lambda_1 x_1]}\\\\\nF_{21}(x_1,x_2)=1-\\exp[-\\lambda_2x_2-\\theta x_1x_2]\n\\end{gathered}\n$$\n\n\nNow we need to invert this conditional distribution function for $u_2$ and drop in the marginal quantile function $Q_1(u_1)$ in place of $x_1$.\n\n\n$$\n\\begin{gathered}\nu_2=1-\\exp[-\\lambda_2x_2-\\theta x_1x_2]\\\\\n1-u_2=\\exp[-\\lambda_2x_2-\\theta x_1x_2]\\\\\n\\ln(1-u_2)=-\\lambda_2x_2-\\theta x_1x_2\\\\\n\\ln(1-u_2)=x_2(-\\lambda_2-\\theta x_1)\\\\\n\\frac{\\ln(1-u_2)}{-\\lambda_2-\\theta x_1}=x_2\\\\\n\\frac{\\ln(1-u_2)}{-\\lambda_2-\\theta [-\\ln(1-u_1)/\\lambda_1]}=x_2\\\\\n\\frac{\\lambda_1\\ln(1-u_2)}{-\\lambda_2\\lambda_1-\\theta [-\\ln(1-u_1)]}=x_2\\\\\nQ_{21}(u_2\\vert u_1)=\\frac{-\\lambda_1\\ln(1-u_2)}{\\lambda_2\\lambda_1-\\theta \\ln(1-u_1)}\\\\\n\\end{gathered}\n$$\n\n\nSo the Gumbel bivariate exponential function becomes\n\n\n$$\nQ(u_1, u_2)=\\left( \\frac{1}{\\lambda_1\\ln(1-u_1)}, \\frac{-\\lambda_1\\ln(1-u_2)}{\\lambda_2\\lambda_1-\\theta \\ln(1-u_1)}\\right)\n$$\n\n\nThis is the exactly the result reported in the paper.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nqgumbelexp1 <- function(u, lambda){\n -log(1-u)/lambda\n}\n\nqgumbelexp21 <- function(u2, u1, lambda2, lambda1, theta){\n -lambda1*log(1-u2)/(lambda1*lambda2-theta*log(1-u1))\n}\n\nset.seed(1)\nn <- 1e3\ntheta <- 3\nlambda1 <- 1; lambda2 <- 2\ntibble::tibble(u1=runif(n),\n               u2=runif(n),\n               x1=qgumbelexp1(u1, lambda1),\n               x2=qgumbelexp21(u2, u1, lambda2, lambda1, theta)) %>%  \n  ggplot()+\n  geom_point(aes(x1, x2))+\n  theme_ipsum_rc(grid_col=\"grey95\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n## Properties of bivariate quantiles\n\nYou might ask: \"Wow, that's a lot of math! Why do we care about bivariate quantiles?\" and \"Well, don't they require invertible joint distribution functions?\"\n\nThe cool thing about bivariate quantile functions (bQFs) come from their properties discussed in @nair2023PropertiesBivariateDistributions. The authors list 9 properties, which are, in some sense, extensions of @gilchrist2000StatisticalModellingQuantile properties for univariate QFs. In particular, the properties 6 through 9 are pretty cool.\n\nThe authors start by stating that the conditional bQFs $Q_{21}$ do not necessarily have to come from inverting the conditional distribution function $F_{21}$. In fact, any left-continuous, increasing function in $u_2$, for all $u_1 \\in [0,1]$ can be picked at $Q_{21}$ (provided that the combination $(Q_1, Q_{21})$ results in a meaningful bivariate model).\n\nIt turns out (Property 6) that the conditional bQF $Q_{21}(u_2\\vert u_1)$ can be constructed as a sum of two univariate QFs, i.e. this represents a valid bQF $(Q_1(u_1), Q_1(u_1)+Q_2(u_2))$. If $Q_1$ is left-bounded at zero, i.e. $Q_1(0)=0$ then the marginals of such bQF are $Q_1(u_1)$ and $Q_2(u_2)$! This finding generalizes Gilchrist's \"addition rule\" [@gilchrist2000StatisticalModellingQuantile]. Similar to the univariate case, also works for quantile densities (Property 7). \n\nProperty 8 says that for the positive QFs the product is also a valid conditional bQF, generalizing the \"product rule\" [@gilchrist2000StatisticalModellingQuantile]. Finally, Property 9 generalizes the \"Q-transformation rule\", postulating that for every increasing transformation functions $T_1$ and $T_2$, $\\left[T_1(Q_1(u_1)), T_1(Q_1(u_1))+T_2(Q_2(u_2))\\right]$ is also a valid bQF. The main implication here is that the bQFs can be defined without the reference to the join distribution function (and even without closed form $F(x_1, x_2)$)!\n\n## Conclusion\n\nSo why do we care? Given what we have discussed in @perepolkin2021TenetsQuantilebasedInference, priors can be defined using the quantile functions without the reference to the densities. This not only means that you don't need PDFs to define the prior, but also that you don't need QDF, because it will cancel itself with the Jacobian.\n\nNow with bQFs, you can define the bivariate priors using quantile functions, provided that the conditional bQF $Q_{21}$ that you crafted makes sense.\n\nPerhaps some Stan examples would be in order. I am sure we will come back to the bivariate quantiles for some cool quantile distribution application soon.\n\n## References\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}